<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Botânica Brasileira - Dados Oficiais</title>
    <style>
        /* Estilos mantidos do anterior, ajustando apenas cores */
        body { background: #080808; color: #fff; }
        h1, h2, h3 { color: #28a745; }
        .card { background: #121212; }
        .btn { background: #28a745; }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
</head>
<body>
    <div class="container">
        <h1>Dados Oficiais da Flora Brasileira</h1>

        <!-- Seção de Estatísticas em Tempo Real -->
        <section>
            <h2>Estatísticas Nacionais</h2>
            <div class="grid" id="estatisticas"></div>
        </section>

        <!-- Mapa de Ocorrências Científicas -->
        <section>
            <h2>Registros Científicos</h2>
            <div id="mapa" style="height: 500px; margin: 2rem 0;"></div>
        </section>

        <!-- Lista de Espécies Ameaçadas -->
        <section>
            <h2>Espécies Ameaçadas (CNCFlora)</h2>
            <div id="especies-ameacadas"></div>
        </section>
    </div>

    <script>
        // Dados do IBGE
        async function fetchIBGEData() {
            const response = await fetch('https://servicodados.ibge.gov.br/api/v1/paises/BR/indicadores/77868');
            const data = await response.json();
            return data[0].ultimovalor;
        }

        // Dados GBIF
        async function fetchGBIFData() {
            const response = await fetch('https://api.gbif.org/v1/occurrence/search?country=BR&limit=300');
            return response.json();
        }

        // Dados CNCFlora
        async function fetchAmeacadas() {
            const response = await fetch('https://api.cncflora.jbrj.gov.br/api/v1/especies?categoria_de_ameaca=CR');
            return response.json();
        }

        // Carrega dados
        async function init() {
            // IBGE - Área vegetal
            const areaVegetal = await fetchIBGEData();
            document.getElementById('estatisticas').innerHTML = `
                <div class="card">
                    <h3>Área Vegetal Natural</h3>
                    <p>${(areaVegetal / 10000).toLocaleString('pt-BR')} km²</p>
                </div>
            `;

            // GBIF - Mapa
            const gbifData = await fetchGBIFData();
            const map = L.map('mapa').setView([-14.2350, -51.9253], 4);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            
            gbifData.results.forEach(record => {
                if(record.decimalLatitude && record.decimalLongitude) {
                    L.marker([record.decimalLatitude, record.decimalLongitude])
                     .bindPopup(`<b>${record.species || 'Espécie não identificada'}</b>`)
                     .addTo(map);
                }
            });

            // CNCFlora - Espécies ameaçadas
            const ameacadas = await fetchAmeacadas();
            const lista = ameacadas.result.map(especie => `
                <div class="card" style="margin: 1rem 0;">
                    <h3>${especie.nome_cientifico}</h3>
                    <p>Nome popular: ${especie.nome_popular || 'Não registrado'}</p>
                    <p>Bioma: ${especie.bioma}</p>
                </div>
            `).join('');
            
            document.getElementById('especies-ameacadas').innerHTML = lista;
        }

        init();
    </script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</body>
</html>